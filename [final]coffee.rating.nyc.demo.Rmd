---
title: "Coffee Rating & NYC Demographics by Zip Code"
author: "Nikky Xiong"
date: "3/22/2020"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE, message=FALSE}
library(readr)
library(dplyr)
library(broom)

nyc_demo <- read_csv("nyc_zip_demo.csv")
nyc_demo_more <- read_csv('raw_data/nyc_zip_demographics.csv')
nyc_demo <- left_join(nyc_demo, nyc_demo_more,by = c("Zipcode" = "ZIPCODE"))
coffee_zip <- read_csv("coffee_zip.csv")
df <- left_join(coffee_zip, nyc_demo) %>% 
    mutate(Women_pct = 100 - Men_pct)
```

# visualization 

```{r, warning=FALSE, message=FALSE}
library(ggthemes)
library(ggplot2)
library(tidyr)

pc1 <- ggplot(df, aes(x = Total_Income, y = Avg_rating, 
                          color = Name)) + 
    geom_point(alpha = 0.8, radius = 0.5) +
    xlab('Total Income') + 
    ylab('Average Rating for Coffee Shops') + 
    labs(caption = 'Data Source: Yelp') +
    geom_smooth(method=lm, se=FALSE, linetype="dashed") +
    ggtitle('Total Income vs Average Rating for Coffee') +
    theme_linedraw() +
    scale_color_manual(values = c("#34afd1", "#f09a56", 
                                 "#87dc97")) +
    theme(plot.title = element_text(size=14, face="bold", hjust = 0.5),
          legend.text = element_text(size=8),
          legend.title = element_text(size=8))
pc1
```

```{r, warning=FALSE, message=FALSE}
pc2 <- ggplot(df, aes(x = Mean_Income, y = Avg_rating, 
                          color = Name)) + 
    geom_point(alpha = 0.8, radius = 0.5) +
    xlab('Mean Income') + 
    ylab('Average Rating for Coffee Shops') + 
    labs(caption = 'Data Source: Yelp') +
    geom_smooth(method=lm, se=FALSE, linetype="dashed") +
    ggtitle('Mean Income vs Average Rating for Coffee') +
    theme_linedraw() +
    scale_color_manual(values = c("#34afd1", "#f09a56", 
                                 "#87dc97")) +
    theme(plot.title = element_text(size=14, face="bold", hjust = 0.5),
          legend.text = element_text(size=8),
          legend.title = element_text(size=8))
pc2
```

```{r, warning=FALSE, message=FALSE}
pc3 <- ggplot(df, aes(x = Population, y = Avg_rating, 
                          color = Name)) + 
    geom_point(alpha = 0.8, radius = 0.5) +
    xlab('Population') + 
    ylab('Average Rating for Coffee Shops') + 
    labs(caption = 'Data Source: Yelp') +
    geom_smooth(method=lm, se=FALSE, linetype="dashed") +
    ggtitle('Population vs Average Rating for Coffee') +
    theme_linedraw() +
    scale_color_manual(values = c("#34afd1", "#f09a56", 
                                 "#87dc97")) +
    theme(plot.title = element_text(size=14, face="bold", hjust = 0.5),
          legend.text = element_text(size=8),
          legend.title = element_text(size=8))
pc3
```

## clean up data and do more visualization with demographics

### poverty

```{r, warning=FALSE, message=FALSE}
pc6 <- ggplot(df, aes(x = Poverty_pct, y = Avg_rating, 
                          color = Name)) + 
    geom_point(alpha = 0.8, radius = 0.5) +
    xlab('Poverty Percentage') + 
    ylab('Average Rating for Coffee Shops') + 
    labs(caption = 'Data Source: Yelp') +
    geom_smooth(method=lm, se=FALSE, linetype="dashed") +
    ggtitle('Poverty Percentage vs Average Rating for Coffee') +
    theme_linedraw() +
    scale_color_manual(values = c("#34afd1", "#f09a56", 
                                 "#87dc97")) +
    theme(plot.title = element_text(size=12, face="bold", hjust = 0.5),
          legend.text = element_text(size=8),
          legend.title = element_text(size=8))
pc6
```

### unemployment

```{r, warning=FALSE, message=FALSE}
pc7 <- ggplot(df, aes(x = Unemployment_pct, y = Avg_rating, 
                          color = Name)) + 
    geom_point(alpha = 0.8, radius = 0.5) +
    xlab('Unemployment Percentage') + 
    ylab('Average Rating for Coffee Shops') + 
    labs(caption = 'Data Source: Yelp') +
    geom_smooth(method=lm, se=FALSE, linetype="dashed") +
    ggtitle('Unemployment Percentage vs Average Rating for Coffee') +
    theme_linedraw() +
    scale_color_manual(values = c("#34afd1", "#f09a56", 
                                 "#87dc97")) +
    theme(plot.title = element_text(size=12, face="bold", hjust = 0.5),
          legend.text = element_text(size=8),
          legend.title = element_text(size=8))
pc7
```

```{r}
pc8 <- ggplot(df, aes(x = Unemployment_pct, y = Poverty_pct, 
                          color = Name)) + 
    geom_point(alpha = 0.8, radius = 0.5) +
    xlab('Unemployment Percentage') + 
    ylab('Poverty Percentage') + 
    labs(caption = 'Data Source: Yelp') +
    geom_smooth(method=lm, se=FALSE, linetype="dashed") +
    ggtitle('Unemployment Percentage vs Poverty Percentage') +
    theme_linedraw() +
    scale_color_manual(values = c("#34afd1", "#f09a56", 
                                 "#87dc97")) +
    theme(plot.title = element_text(size=14, face="bold", hjust = 0.5),
          legend.text = element_text(size=8),
          legend.title = element_text(size=8))
pc8
```

# linear regression

```{r, warning=FALSE, message=FALSE}
coffee_lm <- df

coffee_lm$Name[coffee_lm$Name == "Dunkin'"] <- 0
coffee_lm$Name[coffee_lm$Name == "Starbucks"] <- 1
coffee_lm$Name[coffee_lm$Name == "Blue Bottle"] <- 2

coffee_sb <- coffee_lm %>% filter(Name == 1)
coffee_dd <- coffee_lm %>% filter(Name == 0)
coffee_bb <- coffee_lm %>% filter(Name == 2)
```

### gender for SB

```{r}
df_gather <- coffee_sb %>% 
  gather(Men_pct, Women_pct, 
         key = gender, value = gender_value) 
```

```{r, warning=FALSE, message=FALSE}
pc_race <- ggplot(df_gather, aes(x = gender_value, y = Avg_rating,
                                 color = gender)) + 
    geom_point(alpha = 0.8, radius = 0.5) +
    xlab('Gender Percentage') + 
    ylab('Average Rating for Starbucks') + 
    labs(caption = 'Data Source: Yelp') +
    geom_smooth(method=lm, se=FALSE, linetype="dashed") +
    ggtitle('Gender Percentage vs Average Rating for Starbucks') +
    theme_linedraw() +
    scale_color_manual(values = c("#34afd1", "#f09a56", 
                                 "#87dc97"
                                 )) +
    theme(plot.title = element_text(size=12, face="bold", hjust = 0.5),
          legend.text = element_text(size=8),
          legend.title = element_text(size=8))
pc_race
```

### gender for DD

```{r}
df_gather <- coffee_dd %>% 
  gather(Men_pct, Women_pct, 
         key = gender, value = gender_value) 
```

```{r, warning=FALSE, message=FALSE}
pc_race <- ggplot(df_gather, aes(x = gender_value, y = Avg_rating,
                                 color = gender)) + 
    geom_point(alpha = 0.8, radius = 0.5) +
    xlab('Gender Percentage') + 
    ylab('Average Rating for the Dunkin') + 
    labs(caption = 'Data Source: Yelp') +
    geom_smooth(method=lm, se=FALSE, linetype="dashed") +
    ggtitle('Gender Percentage vs Average Rating for the Dunkin') +
    theme_linedraw() +
    scale_color_manual(values = c("#34afd1", "#f09a56", 
                                 "#87dc97"
                                 )) +
    theme(plot.title = element_text(size=12, face="bold", hjust = 0.5),
          legend.text = element_text(size=8),
          legend.title = element_text(size=8))
pc_race
```

### gender for BB

```{r}
df_gather <- coffee_bb %>% 
  gather(Men_pct, Women_pct, 
         key = gender, value = gender_value) 
```

```{r, warning=FALSE, message=FALSE}
pc_race <- ggplot(df_gather, aes(x = gender_value, y = Avg_rating,
                                 color = gender)) + 
    geom_point(alpha = 0.8, radius = 0.5) +
    xlab('Gender Percentage') + 
    ylab('Average Rating for Blue Bottle') + 
    labs(caption = 'Data Source: Yelp') +
    geom_smooth(method=lm, se=FALSE, linetype="dashed") +
    ggtitle('Gender Percentage vs Average Rating for Blue Bottle') +
    theme_linedraw() +
    scale_color_manual(values = c("#34afd1", "#f09a56", 
                                 "#87dc97"
                                 )) +
    theme(plot.title = element_text(size=12, face="bold", hjust = 0.5),
          legend.text = element_text(size=8),
          legend.title = element_text(size=8))
pc_race
```

### race pct for SB

```{r}
df_gather <- coffee_sb %>% 
  gather(White_pct, Black_pct, Native_pct, Asian_pct,
         key = race, value = race_value) 
```

```{r, warning=FALSE, message=FALSE}
pc_race <- ggplot(df_gather, aes(x = race_value, y = Avg_rating, 
                          color = race)) + 
    geom_point(alpha = 0.8, radius = 0.5) +
    xlab('Race Percentage') + 
    ylab('Average Rating for Starbucks') + 
    labs(caption = 'Data Source: Yelp') +
    geom_smooth(method=lm, se=FALSE, linetype="dashed") +
    ggtitle('Race Percentage vs Average Rating for Starbucks') +
    theme_linedraw() +
    scale_color_manual(values = c("#34afd1", "#f09a56", 
                                 "#87dc97", "#ABA9A9")) +
    theme(plot.title = element_text(size=12, face="bold", hjust = 0.5),
          legend.text = element_text(size=8),
          legend.title = element_text(size=8))
pc_race
```

### race pct for DD

```{r}
df_gather <- coffee_dd %>% 
  gather(White_pct, Black_pct, Native_pct, Asian_pct,
         key = race, value = race_value) 
```

```{r, warning=FALSE, message=FALSE}
pc_race <- ggplot(df_gather, aes(x = race_value, y = Avg_rating, 
                          color = race)) + 
    geom_point(alpha = 0.8, radius = 0.5) +
    xlab('Race Percentage') + 
    ylab('Average Rating for the Dunkin') + 
    labs(caption = 'Data Source: Yelp') +
    geom_smooth(method=lm, se=FALSE, linetype="dashed") +
    ggtitle('Race Percentage vs Average Rating for the Dunkin') +
    theme_linedraw() +
    scale_color_manual(values = c("#34afd1", "#f09a56", 
                                 "#87dc97", "#ABA9A9")) +
    theme(plot.title = element_text(size=12, face="bold", hjust = 0.5),
          legend.text = element_text(size=8),
          legend.title = element_text(size=8))
pc_race
```

### race pct for BB

```{r}
df_gather <- coffee_bb %>% 
  gather(White_pct, Black_pct, Native_pct, Asian_pct,
         key = race, value = race_value) 
```

```{r, warning=FALSE, message=FALSE}
pc_race <- ggplot(df_gather, aes(x = race_value, y = Avg_rating, 
                          color = race)) + 
    geom_point(alpha = 0.8, radius = 0.5) +
    xlab('Race Percentage') + 
    ylab('Average Rating for Blue Bottle') + 
    labs(caption = 'Data Source: Yelp') +
    geom_smooth(method=lm, se=FALSE, linetype="dashed") +
    ggtitle('Race Percentage vs Average Rating for Blue Bottle') +
    theme_linedraw() +
    scale_color_manual(values = c("#34afd1", "#f09a56", 
                                 "#87dc97", "#ABA9A9")) +
    theme(plot.title = element_text(size=12, face="bold", hjust = 0.5),
          legend.text = element_text(size=8),
          legend.title = element_text(size=8))
pc_race
```

### Raing vs Total Income

```{r}
library(jtools)
lm <- lm(Avg_rating ~ Total_Income,
         data = coffee_sb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Total_Income,
         data = coffee_dd)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Total_Income,
         data = coffee_dd)
summary(lm)
summ(lm)
```

### Raing vs Mean Income

```{r}
lm <- lm(Avg_rating ~ Mean_Income,
         data = coffee_sb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Mean_Income,
         data = coffee_dd)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Mean_Income,
         data = coffee_bb)
summary(lm)
summ(lm)
```

### Raing vs Population

```{r}
lm <- lm(Avg_rating ~ Population,
         data = coffee_sb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Population,
         data = coffee_dd)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Population,
         data = coffee_bb)
summary(lm)
summ(lm)
```

### Rating vs Gender

#### SB

```{r}
lm <- lm(Avg_rating ~ Women_pct,
         data = coffee_sb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Men_pct,
         data = coffee_sb)
summary(lm)
summ(lm)
```

#### DD

```{r}
lm <- lm(Avg_rating ~ Women_pct,
         data = coffee_dd)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Men_pct,
         data = coffee_dd)
summary(lm)
summ(lm)
```

#### BB

```{r}
lm <- lm(Avg_rating ~ Women_pct,
         data = coffee_bb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Men_pct,
         data = coffee_bb)
summary(lm)
summ(lm)
```

### Rating vs Race

#### SB

```{r}
lm <- lm(Avg_rating ~ White_pct,
         data = coffee_sb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Asian_pct,
         data = coffee_sb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Black_pct,
         data = coffee_sb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Native_pct,
         data = coffee_sb)
summary(lm)
summ(lm)
```

#### DD

```{r}
lm <- lm(Avg_rating ~ White_pct,
         data = coffee_dd)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Asian_pct,
         data = coffee_dd)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Black_pct,
         data = coffee_dd)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Native_pct,
         data = coffee_dd)
summary(lm)
summ(lm)
```

#### BB

```{r}
lm <- lm(Avg_rating ~ White_pct,
         data = coffee_bb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Asian_pct,
         data = coffee_bb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Black_pct,
         data = coffee_bb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Native_pct,
         data = coffee_bb)
summary(lm)
summ(lm)
```

### Rating vs Poverty

```{r}
lm <- lm(Avg_rating ~ Poverty_pct,
         data = coffee_sb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Poverty_pct,
         data = coffee_dd)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Poverty_pct,
         data = coffee_bb)
summary(lm)
summ(lm)
```

### Rating vs Unemployment

```{r}
lm <- lm(Avg_rating ~ Unemployment_pct,
         data = coffee_sb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Unemployment_pct,
         data = coffee_dd)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Unemployment_pct,
         data = coffee_bb)
summary(lm)
summ(lm)
```

### add interaction term

```{r}
lm <- lm(Avg_rating ~ Population*Mean_Income,
         data = coffee_sb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Population*Mean_Income,
         data = coffee_dd)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Population*Mean_Income,
         data = coffee_bb)
summary(lm)
summ(lm)
```

### More

```{r}
lm <- lm(Avg_rating ~ Population + Mean_Income,
         data = coffee_sb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Population + Mean_Income,
         data = coffee_dd)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Population + Mean_Income,
         data = coffee_bb)
summary(lm)
summ(lm)
```

### More 2.0

```{r}
lm <- lm(Avg_rating ~ Population + Mean_Income +
             Avg_review_count,
         data = coffee_sb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Population + Mean_Income +
             Avg_review_count,
         data = coffee_dd)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Population + Mean_Income +
             Avg_review_count,
         data = coffee_bb)
summary(lm)
summ(lm)
```

### More 3.0

```{r}
lm <- lm(Avg_rating ~ Population*Mean_Income +
             Avg_review_count,
         data = coffee_dd)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Population*Mean_Income +
             Avg_review_count,
         data = coffee_bb)
summary(lm)
summ(lm)
```

```{r}
lm <- lm(Avg_rating ~ Population*Mean_Income +
             Avg_review_count,
         data = coffee_sb)
summary(lm)
summ(lm)
```

### More 4.0

```{r}
lm <- lm(Avg_rating ~ Population + Mean_Income + Avg_review_count + Men_pct + White_pct + Asian_pct + Black_pct + Poverty_pct + Unemployment_pct, data = coffee_sb)
summary(lm)
summ(lm)
```

# Supervised Machine Learning

```{r}
coffee_ml <- coffee_lm %>% 
  filter(coffee_lm$Name == 1 | coffee_lm$Name == 0)
```

```{r, warning=FALSE, message=FALSE}
library(caret)

coffee_ml$Name <- factor(coffee_ml$Name, 
                     labels = c("Starbucks", "DD"), 
                     levels = 1:0) 
set.seed(12345)
in_train <- createDataPartition(y = coffee_ml$Avg_rating, 
                                p = 0.8, list = FALSE)
training <- coffee_ml[ in_train, ]
testing  <- coffee_ml[-in_train, ]
```

## logit

```{r}
logit <- glm(Name ~ Avg_rating + Avg_review_count + Population +
               White_tot + Asian_tot + Black_tot, 
             data = training, family = binomial(link = "logit"))

y_hat_logit <- predict(logit, newdata = testing, type = "response")
z_logit <- factor(y_hat_logit > 0.5, 
                  levels = c(TRUE, FALSE), 
                  labels = c("Starbucks", "DD"))

confusionMatrix(z_logit, reference = testing$Name)
```

## LDA

```{r}
LDA <- train(Name ~ Avg_rating + Avg_review_count + Population +
               White_tot + Asian_tot + Black_tot, 
             data = training, method = "lda", 
             reProcess = c("center", "scale"))
z <- predict(LDA, newdata = testing)
confusionMatrix(z, testing$Name)
```

## QDA

```{r}
QDA <- train(Name ~ Avg_rating + Avg_review_count + Population +
               White_tot + Asian_tot + Black_tot, 
             data = training, method = "qda", 
             preProcess = c("center", "scale"))

z_QDA <- predict(QDA, newdata = testing)

confusionMatrix(z_QDA, reference = testing$Name)
```

## PLSDA

```{r}
ctrl_PLSDA <- trainControl(method = "repeatedcv", repeats = 2, 
                     classProbs = TRUE, summaryFunction = twoClassSummary)
PLSDA_grid <- expand.grid(.ncomp = 1:2)

PLSDA <- train(Name ~ Avg_rating + Avg_review_count + Population +
               White_tot + Asian_tot + Black_tot, 
               data = training, method = "pls", 
               preProcess = c("center", "scale"), metric = "ROC", 
               trControl = ctrl_PLSDA, tuneGrid = PLSDA_grid)

z_PLSDA <- predict(PLSDA, newdata = testing)

confusionMatrix(z_PLSDA, reference = testing$Name)
```

## Nearest Shrunken Centroids

```{r}
ctrl_NSC <- trainControl(method = "repeatedcv", repeats = 3, 
                     classProbs = TRUE, summaryFunction = twoClassSummary)
grid_NSC <- data.frame(.threshold = 0:25)

NSC <- train(Name ~ Avg_rating + Avg_review_count + Population +
               White_tot + Asian_tot + Black_tot, 
             data = training, method = "pam", 
             preProcess = c("center", "scale"), metric = "ROC", 
             trControl = ctrl_NSC, tuneGrid = grid_NSC)

z_NSC <- predict(NSC, newdata = testing) 
confusionMatrix(z_NSC, reference = testing$Name)
```

## Boosting

```{r}
gbmControl = trainControl(method="cv", 
                          number=5, returnResamp = "all")

gbm = train(Name ~ Avg_rating + Avg_review_count + Population +
               White_tot + Asian_tot + Black_tot,
            data=training, method="gbm",
            distribution="bernoulli", 
            trControl=gbmControl, verbose=F, 
            tuneGrid=data.frame(.n.trees=seq(100, 1000, 
                                              by = 100), 
                                 .shrinkage=c(0.01, 0.1), 
                                 .interaction.depth=1:2, 
                                 .n.minobsinnode=1:5),
             na.action = na.omit)

y_hat_gbm <- predict(gbm, newdata = testing, na.action = na.pass)

confusionMatrix(y_hat_gbm, reference = testing$Name)
```

## Random Forest

```{r}
library(randomForest)
rf<- randomForest(Name ~ Avg_rating + Avg_review_count + Population +
               White_tot + Asian_tot + Black_tot, 
                  data=training,
                  importance = TRUE,
                  na.action = na.omit)

y_hat_rf <- predict(rf, newdata = testing,
                 type = "response", na.action = na.pass)

confusionMatrix(y_hat_rf, reference = testing$Name)
```

## Neural Network Model

```{r}
nnetGrid <- expand.grid(.decay = c(0, 0.01, .1),
                        .size = c(1:10))
ctrl_nn <- trainControl(method = "cv", number = 10)

nn <- train(Name ~ Avg_rating + Avg_review_count + Population +
               White_tot + Asian_tot + Black_tot, 
            data = training, method = "nnet",
            trControl = ctrl_nn, tuneGrid = nnetGrid,
            preProcess = c("center", "scale"), trace = FALSE)

y_hat_nn <- predict(nn, newdata = testing)
confusionMatrix(y_hat_nn, reference = testing$Name)
```

```{r}
nn <- train(Name ~ Avg_rating + Avg_review_count + Population +
               White_tot + Asian_tot + Black_tot + Median_Income, 
            data = training, method = "nnet",
            trControl = ctrl_nn, tuneGrid = nnetGrid,
            preProcess = c("center", "scale"), trace = FALSE)

y_hat_nn <- predict(nn, newdata = testing)
confusionMatrix(y_hat_nn, reference = testing$Name)
```

```{r}
nn <- train(Name ~ Avg_rating + Avg_review_count +
               White_tot + Asian_tot + Black_tot, 
            data = training, method = "nnet",
            trControl = ctrl_nn, tuneGrid = nnetGrid,
            preProcess = c("center", "scale"), trace = FALSE)

y_hat_nn <- predict(nn, newdata = testing)
confusionMatrix(y_hat_nn, reference = testing$Name)
```

```{r}
nn <- train(Name ~ Avg_rating + Avg_review_count, 
            data = training, method = "nnet",
            trControl = ctrl_nn, tuneGrid = nnetGrid,
            preProcess = c("center", "scale"), trace = FALSE)

y_hat_nn <- predict(nn, newdata = testing)
confusionMatrix(y_hat_nn, reference = testing$Name)
```

## MARS model

```{r, warning=FALSE, message=FALSE}
ctrl_mars <- trainControl(method = "cv", number = 10)
marsGrid <- expand.grid(.degree = 1:3, .nprune = 1:10)

mars <- train(Name ~ Avg_rating + Avg_review_count + Population +
               White_tot + Asian_tot + Black_tot,  
              data = training, method = "earth", 
              trControl = ctrl_mars, tuneGrid = marsGrid)

y_hat_mars <- predict(mars, newdata = testing)
confusionMatrix(y_hat_mars, reference = testing$Name)
```

